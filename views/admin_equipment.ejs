<!DOCTYPE html>
<html lang="en">
  
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>COSCI - ระบบยืมคืนอุปกรณ์ครุภัณฑ์</title>
<meta name="description" content="">
<meta name="author" content="">

<!-- =============== Bootstrap =============== -->
<link rel="stylesheet" type="text/css"  href="/bootstrap.css">

<!-- =============== Stylesheet =============== -->
<link rel="stylesheet" type="text/css"  href="/style.css">
<link rel="stylesheet" type="text/css"  href="/equipStyle.css">
<link rel="stylesheet" type="text/css"  href="/userStyle.css">
<link rel="stylesheet" type="text/css"  href="/borrowStyle.css">
<link rel="stylesheet" type="text/css"  href="/adminStyle.css">
<link rel="stylesheet" type="text/css"  href="/dataStyle.css">
<link rel="stylesheet" type="text/css"  href="/fontface.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Kanit:200,300,400,500,600,700&amp;subset=thai" rel="stylesheet">

<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/sweetalert2/6.1.1/sweetalert2.min.css">
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.1.0/js/bootstrap.min.js"></script>

</head>
<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">
<!-- =============== Navigation =============== -->
<nav id="menu" class="navbar navbar-default navbar-fixed-top">
  <div class="container"> 
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span><span class="icon-bar"></span>
        <span class="icon-bar"></span> 
      </button>
      <a class="navbar-brand page-scroll" href="#">
        <img class="logo-header" src="/cosciLogo.png">
      </a>
    </div>
    
    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li><a href="/admin/<%=usn%>" class="page-scroll">Home&nbsp;&nbsp;&nbsp;•</a></li>
        <li><a href="#" class="page-scroll">Equipment&nbsp;&nbsp;&nbsp;•</a></li>
        <li><a href="/admin/<%=usn%>/history/all" class="page-scroll">History&nbsp;&nbsp;&nbsp;•&nbsp;</a></li>
        <li><a href="/user/logout" class="page-scroll">Logout&nbsp;&nbsp;<i class="fa fa-sign-out"></i>&nbsp;</a></li>
        <li class="user-tag">
          <a href="/admin/<%=usn%>/profile" id="user-tag-a">
            <i class="fa fa-user"></i>&nbsp;&nbsp;
            ID : <%= datas.mem_id %>&nbsp;&nbsp;
              <br>
            <i class="fa fa-clock-o"></i>&nbsp;&nbsp;DATE : <%= todays %>
            <div class="img-user">
              <img src="/user/<%=datas.mem_pic%>">
            </div>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<!-- Portfolio Section -->
<div id="portfolio">
  <div class="container">
    <div class="row" style="margin-top: 160px;">
      <div class="table-wrapper">
        <div class="table-title">
          <div class="row">
            <div class="col-sm-8">
              <h4 style="margin-top: -70px;">
                เช็คสถานะอุปกรณ์
              </h4>
              <div style="width: 200px; margin-left: 250px; margin-top: -40px;">
                <select id="equip_select">
                  <option value="all" selected>อุปกรณ์ทั้งหมด</option> 
                  <% setData.forEach((value, index) => { %>
                  <option value="<%=value.set_id%>"> 
                    <%= value.set_name %> 
                  </option>
                  <% }) %>
                </select>
              </div>
            </div>
                  
            <div class="col-sm-4">
              <div class="edit" style="margin-right: -20px; margin-top: -70px; text-align: right;">
                <div class="dropdown">
                  <button class="btn-top dropdown-toggle" type="button" data-toggle="dropdown">
                    <i class="fa fa-reorder"></i>
                  </button>
                  <ul class="dropdown-menu pull-right">
                    <li><a href="#">เช็คสถานะอุปกรณ์</a></li>
                    <li><a href="/admin/<%=usn%>/add/equipment">เพิ่ม-แก้ไขอุปกรณ์</a></li>
                    <li><a href="/admin/<%=usn%>/equip/setting/all">ตั้งค่าอุปกรณ์</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="calendar"></div>
      </div>  
    </div>
  </div>
</div>


<div>
  <!-- ดึงค่า footer มาแสดงจากไฟล์ footer.ejs -->
  <%- include('footer') -%>
</div>

<script type="text/javascript" src="/jquery.1.11.1.js"></script> 
<script type="text/javascript" src="/bootstrap.js"></script> 
<script type="text/javascript" src="/jquery.isotope.js"></script> 
<script type="text/javascript" src="/main.js"></script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/air-datepicker/2.2.3/js/datepicker.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/air-datepicker/2.2.3/js/i18n/datepicker.en.js"></script>

<script>
$(function() {

let usn = <%-JSON.stringify(usn)%>;
let dataCalendar = <%-JSON.stringify(calData)%>;
let arrSets = <%-JSON.stringify(setData)%>;
var events = [];
var selectOption = "all";
if (selectOption == "all") {
  allSet()
}

$('#equip_select').change(function() {
  selectOption = $(this).children("option:selected").val();    // value of option selected

  if (selectOption == "all") {
    events = []
    allSet()
    $('#calendar').fullCalendar('removeEvents')
    $('#calendar').fullCalendar('addEventSource', events)
  } 
  else {
    events = []
    someSet(selectOption)
    $('#calendar').fullCalendar('removeEvents')
    $('#calendar').fullCalendar('addEventSource', events)
  }
});


// Select Set
function allSet() {
  for (i=0; i<dataCalendar.length; i++) {
    if (dataCalendar[i].bor_status == 'p') {
      events.push({
          title:  'รอการอนุมัติ',
          start:  dataCalendar[i].bor_date,
          color: '#F3C137',
          url: '/admin/' + usn + '&' + dataCalendar[i].bor_id + '/borrow-detail'
      })
    } else if (dataCalendar[i].bor_status == 'a') {
      events.push({
          title:  'ยืม ' + dataCalendar[i].set_name,
          start:  dataCalendar[i].bor_date + 'T' + dataCalendar[i].bor_time,
          end:    dataCalendar[i].bor_return_date + 'T' + dataCalendar[i].bor_return_time,
          color  : '#007CB7',
          url: '/admin/' + usn + '&' + dataCalendar[i].bor_id + '/borrow-detail'
      })
    } else if (dataCalendar[i].bor_status == 'r') {
      events.push({
          title:  'นัดคืนอุปกรณ์',
          start:  dataCalendar[i].bor_return_date + 'T' + dataCalendar[i].bor_return_time,
          color  : '#25BB4B',
          url: '/admin/' + usn + '&' + dataCalendar[i].bor_id + '/borrow-detail'
      })
    }
  }
}

function someSet(os) {
  for (i=0; i<dataCalendar.length; i++) {
    if (os === dataCalendar[i].set_id) {
      if (dataCalendar[i].bor_status == 'p') {
        events.push({
            title:  'รอการอนุมัติ',
            start:  dataCalendar[i].bor_date,
            color  : '#F3C137',
            url: '/admin/' + usn + '&' + dataCalendar[i].bor_id + '/borrow-detail'
        })
      } else if (dataCalendar[i].bor_status == 'a') {
        events.push({
            title:  'ยืม ' + dataCalendar[i].set_name,
            start:  dataCalendar[i].bor_date + 'T' + dataCalendar[i].bor_time,
            end:    dataCalendar[i].bor_return_date + 'T' + dataCalendar[i].bor_return_time,
            color  : '#007CB7',
            url: '/admin/' + usn + '&' + dataCalendar[i].bor_id + '/borrow-detail'
        })
      } else if (dataCalendar[i].bor_status == 'r') {
        events.push({
            title:  'นัดคืนอุปกรณ์',
            start:  dataCalendar[i].bor_return_date + 'T' + dataCalendar[i].bor_return_time,
            color  : '#25BB4B',
            url: '/admin/' + usn + '&' + dataCalendar[i].bor_id + '/borrow-detail'
        })
      }
    }
  }
}


  $('#calendar').fullCalendar({
    header: {
      left: 'prev,next today',
      center: 'title',
      right: 'month'
    },
    themeSystem: 'bootstrap4',
    defaultView: 'month',
    timeFormat: 'h:mma',
    allDaySlot: false,
    eventOverlap: function(stillEvent, movingEvent) {
      return true;
    },
    events: events,
    editable: false,
    selectable: true,
    eventLimit: true,
    selectHelper: false
  });


});

</script>


</body>
</html>