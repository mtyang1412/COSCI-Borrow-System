<!DOCTYPE html>
<html lang="en">
  
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>COSCI - ระบบยืมคืนอุปกรณ์ครุภัณฑ์</title>
<meta name="description" content="">
<meta name="author" content="">

<!-- =============== Bootstrap =============== -->
<link rel="stylesheet" type="text/css"  href="/bootstrap.css">

<!-- =============== Stylesheet =============== -->
<link rel="stylesheet" type="text/css"  href="/style.css">
<link rel="stylesheet" type="text/css"  href="/userStyle.css">
<link rel="stylesheet" type="text/css"  href="/borrowStyle.css">
<link rel="stylesheet" type="text/css"  href="/profileStyle.css">
<link rel="stylesheet" type="text/css"  href="/fontface.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,900" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Kanit:200,300,400,500,600,700&amp;subset=thai" rel="stylesheet">


<style>
  /* Button search month & year */
  .searchmy {
    background-color: gray;
    color: white;
    border-radius: 5px;
    border: transparent;
    padding: 3px 10px;
    margin-left: 15px;
    cursor: pointer;
  }
  .searchmy:hover {
    background-color: darkgray;
  }

  /* Set font size of star */
  .star {
    font-size: 30px;
  }

  /* Three column layout */
  .side {
    float: left;
    width: 15%;
    margin-top: 10px;
  }
  .middle {
    margin-top: 10px;
    float: left;
    width: 70%;
  }

  /* Place text to the right */
  .right {
    text-align: right;
  }

  /* Clear floats after the columns */
  .cleer:after {
    content: "";
    display: table;
    clear: both;
  }

  /* The bar container */
  .bar-container {
    width: 100%;
    background-color: #f1f1f1;
    text-align: center;
    color: white;
  }

  /* Individual bars */
  .bar-5 {width: 0%; height: 18px; background-color: #15AF14;}
  .bar-4 {width: 0%; height: 18px; background-color: #01A2FF;}
  .bar-3 {width: 0%; height: 18px; background-color: #F9E000;}
  .bar-2 {width: 0%; height: 18px; background-color: #FF9300;}
  .bar-1 {width: 0%; height: 18px; background-color: #F44336;}

  /* Responsive layout - make the columns stack on top of each other instead of next to each other */
  @media (max-width: 767px) {
    .side, .middle {
      width: 100%;
    }
    .right {
      display: none;
    }
  }
</style>

</head>
<body id="page-top" data-spy="scroll" data-target=".navbar-fixed-top">
<!-- =============== Navigation =============== -->
<nav id="menu" class="navbar navbar-default navbar-fixed-top">
  <div class="container"> 
    <!-- Brand and toggle get grouped for better mobile display -->
      <div class="navbar-header">
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span><span class="icon-bar"></span> <span class="icon-bar"></span> 
        </button>
        <a class="navbar-brand page-scroll" href="#">
          <img class="logo-header" src="/cosciLogo.png">
        </a>
      </div>
          
    <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
        <ul class="nav navbar-nav navbar-right">
          <li><a href="/admin/<%=usn%>" class="page-scroll">Home&nbsp;&nbsp;&nbsp;•</a></li>
          <li><a href="/admin/<%=usn%>/manage/equipment" class="page-scroll">Equipment&nbsp;&nbsp;&nbsp;•</a></li>
          <li><a href="/admin/<%=usn%>/history/all" class="page-scroll">History&nbsp;&nbsp;&nbsp;•&nbsp;</a></li>
          <li><a href="/user/logout" class="page-scroll">Logout&nbsp;&nbsp;<i class="fa fa-sign-out"></i>&nbsp;</a></li>
          <li class="user-tag">
            <a href="#" id="user-tag-a">
              <i class="fa fa-user"></i>&nbsp;&nbsp;
              ID : <%= datas.mem_id %>&nbsp;&nbsp;
              <br>
              <i class="fa fa-clock-o"></i>&nbsp;&nbsp;DATE : <%= todays %>
              <div class="img-user"><img src="/user/<%= datas.mem_pic %>"></div>
            </a>
          </li>
        </ul>
      </div>
  </div>
</nav>

<div id="portfolio">
  <div class="section-profile-title">
    <div class="overlay">
      <div class="container">
        <div class="row">
          <br><br><br><br>
          <div class="user-text">
            <h2>สวัสดี ADMIN <br>
              <span style="font-size: 28px;">
                (<%= datas.staff_name %>)
              </span> 
            </h2>
            <hr>
          </div>

          <div class="container">
            <div class="row" id="user-profile">
              <div class="col-lg-3 col-md-4 col-sm-4">
                <div class="main-box clearfix">
                    <img src="/user/<%= datas.mem_pic %>" alt="" class="profile-img img-responsive center-block">
                
                    <div class="profile-details">
                      <ul class="fa-ul">
                        <li>
                          <i class="fa-li fa fa-user"></i>
                          ชื่อผู้ใช้ : <span><%= datas.mem_username%></span>
                        </li>
                      </ul>
                    </div>
                </div>
              </div>
                
              <div class="col-lg-9 col-md-8 col-sm-8">
                <div class="main-box clearfix">
                  <div class="profile-header">
                    <h3><span>ข้อมูลส่วนตัว</span></h3>
                    <div class="edit">
                      <div class="dropdown edit-profile">
                        <button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">
                          <i class="fa fa-gear"></i>
                        </button>
                        <ul class="dropdown-menu pull-right">
                          <li><a href="/admin/<%=usn%>/profile/edit-info">แก้ไขข้อมูลส่วนตัว</a></li>
                          <li><a href="/admin/<%=usn%>/profile/edit-pass">เปลี่ยนรหัสผ่าน</a></li>
                        </ul>
                      </div>
                    </div>
                  </div>
                
                  <div class="row profile-user-info">
                    <div class="col-sm-12 col-lg-5 col-md-12 profile-social">
                      <div class="profile-user-details clearfix">
                        <div class="profile-user-details-label">
                          รหัสประจำตัว
                        </div>
                        <div class="profile-user-details-value">
                            : <%= datas.mem_id%>
                        </div>
                      </div>
                                        
                      <div class="profile-user-details clearfix">
                        <div class="profile-user-details-label">ชื่อ-นามสกุล</div>
                        <div class="profile-user-details-value">
                            : <%= datas.staff_name%>
                        </div>
                      </div>

                      <div class="profile-user-details clearfix">
                        <div class="profile-user-details-label">ตำแหน่ง</div>
                        <div class="profile-user-details-value">
                            : <%= datas.staff_position%>
                        </div>
                      </div>
                    </div>

                    <div class="col-sm-12 col-lg-7 col-md-12 profile-social">
                      <div class="profile-user-details clearfix">
                        <div class="profile-user-details-label">อีเมล</div>
                        <div class="profile-user-details-value">
                            : <%= datas.mem_email%>
                        </div>
                      </div>
                                        
                      <div class="profile-user-details clearfix">
                        <div class="profile-user-details-label">เบอร์โทรศัพท์</div>
                        <div class="profile-user-details-value">
                            : <%= datas.mem_phone%>
                        </div>
                      </div>
                    </div>

                  </div>

                  <div class="tabs-wrapper profile-tabs">
                    <ul class="nav nav-tabs">
                      <li class="active">
                        <a href="#tab-rating" data-toggle="tab">
                          ผลการประเมิน
                        </a>
                      </li>
                      <li><a href="#tab-comment" data-toggle="tab">
                        ความคิดเห็น
                      </a>
                      </li>
                    </ul>
                    <!-- // กำลังทำอยู่ -->
                    
                    
                    <div class="tab-content">
                      <!-- ===== สรุปผลการประเมินประจำเดือน ===== -->
                      <div class="tab-pane fade in active" id="tab-rating">
                        <div style="margin: 10px;">
                          <form action="/admin/<%=usn%>/profile/my" method="POST">
                            เดือน: 
                            <select name="ssafmonth" id="sselectmonth" style="width: 100px; margin-right: 15px;">
                              <option value="1">มกราคม</option>
                              <option value="2">กุมภาพันธ์</option>
                              <option value="3">มีนาคม</option>
                              <option value="4">เมษายน</option>
                              <option value="5">พฤษภาคม</option>
                              <option value="6">มิถุนายน</option>
                              <option value="7">กรกฎาคม</option>
                              <option value="8">สิงหาคม</option>
                              <option value="9">กันยายน</option>
                              <option value="10">ตุลาคม</option>
                              <option value="11">พฤศจิกายน</option>
                              <option value="12">ธันวาคม</option>
                            </select>

                            ปี:
                            <select name="ssafyear" id="sselectyear" style="width: 65px;">
                              <% for (y=(dateComment.maxyear); y>=(dateComment.minyear) ;y--) { %>
                                <% let bc = (y-543) %>
                                <option value="<%=bc%>"><%= y %></option>
                              <% } %>
                            </select>

                            <button type="submit" class="searchmy">
                              <i class="fa fa-search"></i>
                            </button>
                          </form>

                          <% if (satisfaction.length > 0) { %>
                            <div style="margin-top: 45px; padding: 0 50px;">
                              <span style="font-size: 22px; margin-right: 25px;">
                                คะแนนการบริการ
                              </span>
                              <span id="star1" class="star fa fa-star-o"></span>
                              <span id="star2" class="star fa fa-star-o"></span>
                              <span id="star3" class="star fa fa-star-o"></span>
                              <span id="star4" class="star fa fa-star-o"></span>
                              <span id="star5" class="star fa fa-star-o"></span>
                              
                              <p style="margin-top: 6px;">
                                คะแนนเฉลี่ย <span id="averageScore"></span> คะแนน &nbsp;&nbsp;
                                จาก <span id="scoreMember"></span> การประเมิน
                              </p>
                              <hr style="border: 2px solid #F1F1F1; width: 100%; background-color: #F1F1F1;">

                              <div class="cleer">
                                <div class="side"> 5 ดาว </div>
                                <div class="middle">
                                  <div class="bar-container">
                                    <div class="bar-5"></div>
                                  </div>
                                </div>
                                <div class="side right">
                                  <div id="count5"></div>
                                </div>

                                <div class="side"> 4 ดาว </div>
                                <div class="middle">
                                  <div class="bar-container">
                                    <div class="bar-4"></div>
                                  </div>
                                </div>
                                <div class="side right">
                                  <div id="count4"></div>
                                </div>

                                <div class="side"> 3 ดาว </div>
                                <div class="middle">
                                  <div class="bar-container">
                                    <div class="bar-3"></div>
                                  </div>
                                </div>
                                <div class="side right">
                                  <div id="count3"></div>
                                </div>

                                <div class="side"> 2 ดาว </div>
                                <div class="middle">
                                  <div class="bar-container">
                                    <div class="bar-2"></div>
                                  </div>
                                </div>
                                <div class="side right">
                                  <div id="count2"></div>
                                </div>

                                <div class="side"> 1 ดาว </div>
                                <div class="middle">
                                  <div class="bar-container">
                                    <div class="bar-1"></div>
                                  </div>
                                </div>
                                <div class="side right">
                                  <div id="count1"></div>
                                </div>

                              </div>
                            </div>
                          <% } else { %>
                            <div style="margin-top: 45px; width: 100%; text-align: center;">
                              <br>
                              ไม่พบผลการประเมิน
                              <br>
                            </div>
                          <% } %>
                        </div>
                      </div>

                      <!-- ===== ความคิดเห็นจากผู้ใช้บริการ ===== -->
                      <div class="tab-pane fade" id="tab-comment">
                        <div style="margin: 10px;">
                          <form action="/admin/<%=usn%>/profile/my" method="POST">
                            เดือน: 
                            <select name="ssafmonth" id="cselectmonth" style="width: 100px; margin-right: 15px;">
                              <option value="1">มกราคม</option>
                              <option value="2">กุมภาพันธ์</option>
                              <option value="3">มีนาคม</option>
                              <option value="4">เมษายน</option>
                              <option value="5">พฤษภาคม</option>
                              <option value="6">มิถุนายน</option>
                              <option value="7">กรกฎาคม</option>
                              <option value="8">สิงหาคม</option>
                              <option value="9">กันยายน</option>
                              <option value="10">ตุลาคม</option>
                              <option value="11">พฤศจิกายน</option>
                              <option value="12">ธันวาคม</option>
                            </select>

                            ปี:
                            <select name="ssafyear" id="cselectyear" style="width: 65px;">
                              <% for (y=(dateComment.maxyear); y>=(dateComment.minyear) ;y--) { %>
                                <% let bc = (y-543) %>
                                <option value="<%=bc%>"><%= y %></option>
                              <% } %>
                            </select>

                            <button type="submit" class="searchmy">
                              <i class="fa fa-search"></i>
                            </button>
                          </form>

                          <% if (satisfaction.length > 0) { %>
                            <div style="margin-top: 35px; padding: 0 15px; line-height: 20px;">
                              <% var i = 0 %>
                              <% var comments = '' %>
                              <table style="width: 100%;">
                                <% satisfaction.forEach((v) => { %>
                                  <% i += 1 %>
                                  <% if (v.saf_comment == null) { %>
                                    <% comments = '-' %>
                                  <% } else if ((v.saf_comment).length < 1) { %>
                                    <% comments = '-' %>
                                  <% } else { %>
                                    <% comments = v.saf_comment %>
                                  <% } %>
                                  <tr style="border-bottom: #EBEBEB solid 1px;">
                                    <td style="width: 8%;"><%= i %></td>
                                    <td style="width: 92%;"><%= comments %></td>
                                  </tr>
                                <% }) %>
                              </table>
                            </div>
                          <% } else { %>
                            <div style="margin-top: 45px; width: 100%; text-align: center;">
                              <br>
                              ไม่พบผลการประเมิน
                              <br>
                            </div>
                          <% } %>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


      
<div>
  <!-- ดึงค่า footer มาแสดงจากไฟล์ footer.ejs -->
  <%- include('footer') -%>
</div>
    
<!-- Menu Toggle Script -->

<script type="text/javascript" src="/jquery.1.11.1.js"></script> 
<script type="text/javascript" src="/bootstrap.js"></script> 
<script type="text/javascript" src="/jquery.isotope.js"></script> 
<script type="text/javascript" src="/main.js"></script>

<script>

var dateComment = <%-JSON.stringify(dateComment)%>;
var satisfaction = <%-JSON.stringify(satisfaction)%>;

/* -- ตั้งค่าเดือน -- */
let nummonth = dateComment.monthselect;
document.getElementById("cselectmonth").selectedIndex = (nummonth - 1);
document.getElementById("sselectmonth").selectedIndex = (nummonth - 1);

/* -- ตั้งค่าปี -- */
const today = new Date();
let yearnow = today.getFullYear();
let selectyear = (dateComment.yearselect) - 543;
let numyear = yearnow - selectyear;
document.getElementById("cselectyear").selectedIndex = (numyear);
document.getElementById("sselectyear").selectedIndex = (numyear);


/* -- star rating -- */
let sumUserRating = satisfaction.length;
$('#scoreMember').text(sumUserRating);

var cnt1star = 0;
var cnt2star = 0;
var cnt3star = 0;
var cnt4star = 0;
var cnt5star = 0;

for (s=0; s<(sumUserRating) ;s++) {
  if (satisfaction[s].saf_score == 1) {
    cnt1star += 1
  }
  else if (satisfaction[s].saf_score == 2) {
    cnt2star += 1
  }
  else if (satisfaction[s].saf_score == 3) {
    cnt3star += 1
  }
  else if (satisfaction[s].saf_score == 4) {
    cnt4star += 1
  }
  else {
    cnt5star += 1
  }
}

let sumStar = ((1 * cnt1star) + (2 * cnt2star) + (3 * cnt3star) + 
              (4 * cnt4star) + (5 * cnt5star)) / sumUserRating
sumStar = parseFloat(sumStar).toFixed(2)
$('#averageScore').text(sumStar);

function setStar(min1, max1, starID) {
  if (sumStar >= min1 && sumStar < max1) {
    starID.removeClass('fa fa-star-o');
    starID.addClass('fa fa-star-half-o');
  }
  else if (sumStar >= max1) {
    starID.removeClass('fa fa-star-o');
    starID.addClass('fa fa-star');
  }
}

setStar(0.40, 0.80, $('#star1'))
setStar(1.30, 1.80, $('#star2'))
setStar(2.30, 2.80, $('#star3'))
setStar(3.30, 3.80, $('#star4'))
setStar(4.30, 4.80, $('#star5'))

/* -- Scor Bar -- */
let percentTab1 = parseFloat((cnt1star * 100) / sumUserRating).toFixed(2);
let percentTab2 = parseFloat((cnt2star * 100) / sumUserRating).toFixed(2);
let percentTab3 = parseFloat((cnt3star * 100) / sumUserRating).toFixed(2);
let percentTab4 = parseFloat((cnt4star * 100) / sumUserRating).toFixed(2);
let percentTab5 = parseFloat((cnt5star * 100) / sumUserRating).toFixed(2);
$('.bar-1').width(percentTab1 + '%');
$('.bar-2').width(percentTab2 + '%');
$('.bar-3').width(percentTab3 + '%');
$('.bar-4').width(percentTab4 + '%');
$('.bar-5').width(percentTab5 + '%');

$('#count1').text(cnt1star);
$('#count2').text(cnt2star);
$('#count3').text(cnt3star);
$('#count4').text(cnt4star);
$('#count5').text(cnt5star);



</script>

</body>
</html>